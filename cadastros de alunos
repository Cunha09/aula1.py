from fastapi import FastAPI, HTTPException, status
from pydantic import BaseModel
from typing import Dict


app = FastAPI(
    title="API de Cadastro de Alunos",
    description="API realizara o cadastro de alunos, permitir deletar cadastros,  permitir atualizar um cadastro e permitir deletar um cadastro.",
    version="1.0.0"
)


# Modelo de dados do Aluno usando Pydantic
class Aluno(BaseModel):
    matricula: int
    nome: str
    turma: str
    idade: int
   
   # "Banco de dados" em memória (um dicionário Python)
db_alunos: Dict[int, Aluno] = {
    1: Aluno(matricula=12, nome= "Luisa", turma= "203", idade=16),
    2: Aluno(matricula=13, nome= "Ana Paula", turma= "303", idade=35),
    3: Aluno(matricula=14, nome= "Alexsander", turma= "301", idade=18),
}
# --- ENDPOINTS DA API ---


@app.get("/")
def read_root():
    """Endpoint raiz da API."""
    return {"message": "Bem-vindo à API dos Alunos! Acesse /docs para a documentação interativa."}


@app.get("/Alunos")
def pegar_todos_Alunos():
    """Retorna todos os Alunos cadastrados."""
    return db_alunos


@app.get("/Alunos/{id}")
def pegar_Aluno_por_id(id: int):
    """Retorna um Aluno específico pelo seu Id."""
    if id not in db_alunos:
        raise HTTPException(status_code=status.HTTP_404_NOT_FOUND, detail="Aluno não encontrado")
    return db_alunos[id]


@app.post("/lAlunos/{id}", status_code=status.HTTP_201_CREATED)
def criar_Aluno(id: int, aluno: Aluno):
    """Cria um novo Aluno com um id específico."""
    if id in db_alunos:
        raise HTTPException(status_code=status.HTTP_409_CONFLICT, detail="Esse Aluno já existe")
   
    db_alunos[id] = aluno
    return {"message": "Aluno cadastrado com sucesso!", "Id": id, "Aluno": aluno}


@app.put("/Aluno/{id}")
def atualizar_Aluno(id: int, aluno: Aluno):
    """Atualiza as informações de um Aluno existente."""
    if id not in db_alunos:
        raise HTTPException(status_code=status.HTTP_404_NOT_FOUND, detail="Aluno não encontrado")
   
    db_alunos[id] = aluno
    return {"message": "Cadastro do Aluno atualizado com sucesso!", "Aluno": aluno}


@app.delete("/Aluno/{id}")
def deletar_Aluno(id: int):
    """Deleta o cadastro de um Aluno."""
    if id not in db_alunos:
        raise HTTPException(status_code=status.HTTP_404_NOT_FOUND, detail="Aluno não encontrado")
   
    del db_alunos[id]
    return {"message": "Aluno deletado com sucesso!"}
